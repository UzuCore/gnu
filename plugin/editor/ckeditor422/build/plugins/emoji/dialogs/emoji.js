
CKEDITOR.dialog.add('emojiDialog', function(editor) {
    var emojiCategories = {
    "😀 감정": [
        "😀",
        "😃",
        "😄",
        "😁",
        "😆",
        "😅",
        "🤣",
        "😂",
        "🙂",
        "🙃",
        "😉",
        "😊",
        "😇",
        "🥰",
        "😍",
        "🤩",
        "😘",
        "😗",
        "😚",
        "😙",
        "😋",
        "😛",
        "😜",
        "🤪",
        "😝",
        "🤑",
        "🤗",
        "🤭",
        "🤫",
        "🤔",
        "🤐",
        "🤨",
        "😐",
        "😑",
        "😶",
        "😏",
        "😒",
        "🙄",
        "😬",
        "😌",
        "😔",
        "😪",
        "🤤",
        "😴",
        "😷",
        "🤒",
        "🤕",
        "🤢",
        "🤮",
        "🤧",
        "🥵",
        "🥶",
        "🥴",
        "😵",
        "🤯",
        "🤠",
        "🥳",
        "😎",
        "🤓",
        "🧐",
        "😕",
        "😟",
        "🙁",
        "☹️",
        "😮",
        "😯",
        "😲",
        "😳",
        "🥺",
        "😦",
        "😧",
        "😨",
        "😰",
        "😥",
        "😢",
        "😭",
        "😱",
        "😖",
        "😣",
        "😞",
        "😓",
        "😩",
        "😫",
        "🥱",
        "😤",
        "😡",
        "😠",
        "🤬",
        "😈",
        "👿",
        "💀",
        "☠️",
        "👻",
        "👽",
        "👾",
        "🤖"
    ],
    "🧍 사람": [
        "👶",
        "🧒",
        "👦",
        "👧",
        "🧑",
        "👨",
        "👩",
        "🧔",
        "👱‍♂️",
        "👱‍♀️",
        "👴",
        "👵",
        "🙍‍♂️",
        "🙍‍♀️",
        "🙎‍♂️",
        "🙎‍♀️",
        "🙅‍♂️",
        "🙅‍♀️",
        "🙆‍♂️",
        "🙆‍♀️",
        "💁‍♂️",
        "💁‍♀️",
        "🙋‍♂️",
        "🙋‍♀️",
        "🙇‍♂️",
        "🙇‍♀️",
        "🤦‍♂️",
        "🤦‍♀️",
        "🤷‍♂️",
        "🤷‍♀️",
        "🧑‍⚕️",
        "🧑‍🎓",
        "🧑‍🏫",
        "🧑‍⚖️",
        "🧑‍🌾",
        "🧑‍🍳",
        "🧑‍🔧",
        "🧑‍🏭",
        "🧑‍💼",
        "🧑‍🔬",
        "🧑‍💻",
        "🧑‍🎤",
        "🧑‍🎨",
        "🧑‍✈️",
        "🧑‍🚀",
        "🧑‍🚒"
    ],
    "🐶 동물/자연": [
        "🐶",
        "🐱",
        "🐭",
        "🐹",
        "🐰",
        "🦊",
        "🐻",
        "🐼",
        "🐻‍❄️",
        "🐨",
        "🐯",
        "🦁",
        "🐮",
        "🐷",
        "🐽",
        "🐸",
        "🐵",
        "🙈",
        "🙉",
        "🙊",
        "🐒",
        "🐔",
        "🐧",
        "🐦",
        "🐤",
        "🐣",
        "🐥",
        "🦆",
        "🦅",
        "🦉",
        "🦇",
        "🐺",
        "🐗",
        "🐴",
        "🦄",
        "🐝",
        "🪱",
        "🐛",
        "🦋",
        "🐌",
        "🐞",
        "🐜",
        "🪰",
        "🪲",
        "🪳",
        "🕷️",
        "🕸️",
        "🦂",
        "🐢",
        "🐍",
        "🦎",
        "🦖",
        "🦕",
        "🐙",
        "🦑",
        "🦐",
        "🦞",
        "🦀",
        "🐡",
        "🐠",
        "🐟",
        "🐬",
        "🐳",
        "🐋",
        "🦈",
        "🪸",
        "🐊",
        "🐅",
        "🐆",
        "🦓",
        "🦍",
        "🦧",
        "🦣",
        "🐘",
        "🦛",
        "🦏",
        "🐪",
        "🐫",
        "🦒",
        "🦘",
        "🐃",
        "🐂",
        "🐄",
        "🐎",
        "🐖",
        "🐏",
        "🐑",
        "🦙",
        "🐐",
        "🦌",
        "🐕",
        "🐩",
        "🦮",
        "🐕‍🦺",
        "🐈",
        "🐈‍⬛",
        "🪶",
        "🐓",
        "🦃",
        "🦤",
        "🦚",
        "🦜",
        "🦢",
        "🕊️",
        "🐇",
        "🦝",
        "🦨",
        "🦡",
        "🦫",
        "🦦",
        "🦥",
        "🐁",
        "🐀",
        "🐿️",
        "🦔",
        "🐾",
        "🪲"
    ],
    "🍕 음식": [
        "🍇",
        "🍈",
        "🍉",
        "🍊",
        "🍋",
        "🍌",
        "🍍",
        "🥭",
        "🍎",
        "🍏",
        "🍐",
        "🍑",
        "🍒",
        "🍓",
        "🫐",
        "🥝",
        "🥥",
        "🥑",
        "🍅",
        "🍆",
        "🥒",
        "🥬",
        "🥦",
        "🌽",
        "🌶️",
        "🫑",
        "🫒",
        "🥕",
        "🫚",
        "🧄",
        "🧅",
        "🥔",
        "🍠",
        "🥐",
        "🥯",
        "🍞",
        "🥖",
        "🥨",
        "🧀",
        "🥚",
        "🍳",
        "🧈",
        "🥞",
        "🧇",
        "🥓",
        "🥩",
        "🍗",
        "🍖",
        "🦴",
        "🌭",
        "🍔",
        "🍟",
        "🍕",
        "🥪",
        "🥙",
        "🧆",
        "🌮",
        "🌯",
        "🫔",
        "🥗",
        "🥘",
        "🫕",
        "🍝",
        "🍜",
        "🍲",
        "🍛",
        "🍣",
        "🍱",
        "🥟",
        "🦪",
        "🍤",
        "🍙",
        "🍚",
        "🍘",
        "🍥",
        "🥠",
        "🥮",
        "🍢",
        "🍡",
        "🍧",
        "🍨",
        "🍦",
        "🥧",
        "🧁",
        "🍰",
        "🎂",
        "🍮",
        "🍭",
        "🍬",
        "🍫",
        "🍿",
        "🧋",
        "🍩",
        "🍪",
        "🥤",
        "🧃",
        "🥛",
        "🍼",
        "☕",
        "🍵",
        "🫖",
        "🍶",
        "🍺",
        "🍻",
        "🥂",
        "🍷",
        "🥃",
        "🫗",
        "🍸",
        "🍹",
        "🧉",
        "🍾",
        "🧊"
    ],
    "✈️ 장소": [
        "⛱️",
        "🏖️",
        "🏝️",
        "🏜️",
        "🏕️",
        "🏞️",
        "🌋",
        "🗻",
        "⛰️",
        "🏔️",
        "🏟️",
        "🏛️",
        "🏗️",
        "🏘️",
        "🏚️",
        "🏠",
        "🏡",
        "🏢",
        "🏣",
        "🏤",
        "🏥",
        "🏦",
        "🏨",
        "🏩",
        "🏪",
        "🏫",
        "🏬",
        "🏭",
        "🏯",
        "🏰",
        "💒",
        "🗼",
        "🗽",
        "⛩️",
        "🕌",
        "🛕",
        "🕍",
        "⛪",
        "🕋",
        "⛲",
        "⛺",
        "🌁",
        "🌃",
        "🏙️",
        "🌄",
        "🌅",
        "🌆",
        "🌇",
        "🌉"
    ],
    "⚽ 활동": [
        "⚽",
        "🏀",
        "🏈",
        "⚾",
        "🥎",
        "🏐",
        "🏉",
        "🥏",
        "🎱",
        "🪀",
        "🏓",
        "🏸",
        "🏒",
        "🏑",
        "🥍",
        "🏏",
        "🪃",
        "🥅",
        "⛳",
        "🪁",
        "🏹",
        "🎣",
        "🤿",
        "🥊",
        "🥋",
        "🎽",
        "🛹",
        "🛷",
        "⛸️",
        "🥌",
        "🛼",
        "🪄",
        "🪄",
        "🎯",
        "🎳",
        "🎮",
        "🕹️",
        "🎰",
        "🎲",
        "🧩",
        "🧸",
        "🪆",
        "♟️",
        "🎭",
        "🎨",
        "🧵",
        "🧶",
        "🪡",
        "🪢"
    ],
    "💡 사물": [
        "💡",
        "🔦",
        "🕯️",
        "🪔",
        "🧯",
        "🛢️",
        "💸",
        "💵",
        "💴",
        "💶",
        "💷",
        "💰",
        "💳",
        "🧾",
        "💼",
        "🧳",
        "📁",
        "📂",
        "🗂️",
        "📅",
        "📆",
        "🗒️",
        "🗓️",
        "📇",
        "📈",
        "📉",
        "📊",
        "📋",
        "📌",
        "📍",
        "📎",
        "🖇️",
        "📏",
        "📐",
        "✂️",
        "🗃️",
        "🗄️",
        "🗑️",
        "🔒",
        "🔓",
        "🔏",
        "🔐",
        "🔑",
        "🗝️",
        "🔨",
        "🪓",
        "⛏️",
        "⚒️",
        "🛠️",
        "🗡️",
        "⚔️",
        "💣",
        "🪃",
        "🏹",
        "🛡️",
        "🪚",
        "🔧",
        "🪛",
        "🔩",
        "⚙️",
        "🗜️",
        "⚖️",
        "🦯",
        "🔗",
        "⛓️",
        "🪝",
        "🧰",
        "🧲",
        "🪜",
        "⚗️",
        "🧪",
        "🧫",
        "🧬",
        "🔬",
        "🔭",
        "📡",
        "💉",
        "🩸",
        "💊",
        "🩹",
        "🩺",
        "🚪",
        "🪞",
        "🪟",
        "🛏️",
        "🛋️",
        "🪑",
        "🚽",
        "🚿",
        "🛁",
        "🪠",
        "🪤",
        "🪒",
        "🧴",
        "🧷",
        "🧹",
        "🧺",
        "🧻",
        "🪣",
        "🧼",
        "🪥",
        "🧽",
        "🛒",
        "🚬",
        "⚰️",
        "🪦",
        "⚱️",
        "🧿",
        "🪬"
    ],
    "💯 기호": [
        "❤️",
        "🧡",
        "💛",
        "💚",
        "💙",
        "💜",
        "🤎",
        "🖤",
        "🤍",
        "💔",
        "❣️",
        "💕",
        "💞",
        "💓",
        "💗",
        "💖",
        "💘",
        "💝",
        "💟",
        "☮️",
        "✝️",
        "☪️",
        "🕉️",
        "☸️",
        "✡️",
        "🔯",
        "🕎",
        "☯️",
        "☦️",
        "🛐",
        "⛎",
        "♈",
        "♉",
        "♊",
        "♋",
        "♌",
        "♍",
        "♎",
        "♏",
        "♐",
        "♑",
        "♒",
        "♓",
        "🆔",
        "⚛️",
        "🉑",
        "☢️",
        "☣️",
        "📴",
        "📳",
        "🈶",
        "🈚",
        "🈸",
        "🈺",
        "🈷️",
        "✴️",
        "🆚",
        "💮",
        "🉐",
        "㊙️",
        "㊗️",
        "🈴",
        "🈵",
        "🈹",
        "🈲",
        "🅰️",
        "🅱️",
        "🆎",
        "🆑",
        "🅾️",
        "🆘",
        "❌",
        "⭕",
        "🛑",
        "⛔",
        "📛",
        "🚫",
        "💯",
        "💢",
        "♨️",
        "🚷",
        "🚯",
        "🚳",
        "🚱",
        "🔞",
        "📵",
        "🚭",
        "❗",
        "❕",
        "❓",
        "❔",
        "‼️",
        "⁉️",
        "🔅",
        "🔆",
        "〽️",
        "⚠️",
        "🚸",
        "🔱",
        "⚜️",
        "🔰",
        "♻️",
        "✅",
        "🈯",
        "💹",
        "❇️",
        "✳️",
        "❎",
        "🌐",
        "💠",
        "Ⓜ️",
        "🌀",
        "💤",
        "🏧",
        "🚾",
        "♿",
        "🅿️",
        "🛗",
        "🚮",
        "🚰",
        "♻️",
        "🚹",
        "🚺",
        "🚻",
        "🚼",
        "⚠️"
    ],
    "🇰🇷 국기": [
        "🇰🇷",
        "🇺🇸",
        "🇯🇵",
        "🇨🇳",
        "🇬🇧",
        "🇫🇷",
        "🇩🇪",
        "🇮🇹",
        "🇪🇸",
        "🇷🇺",
        "🇸🇬",
        "🇧🇷",
        "🇮🇳",
        "🇨🇦",
        "🇲🇽",
        "🇹🇭",
        "🇻🇳",
        "🇲🇾",
        "🇸🇦",
        "🇦🇪"
    ]
};
    var recentKey = 'ckeditor_recent_emojis';

    function getRecentEmojis() {
        try {
            return JSON.parse(localStorage.getItem(recentKey)) || [];
        } catch (e) {
            return [];
        }
    }

    function saveRecentEmoji(emoji) {
        var list = getRecentEmojis();
        list = list.filter(e => e !== emoji);
        list.unshift(emoji);
        if (list.length > 20) list = list.slice(0, 20);
        localStorage.setItem(recentKey, JSON.stringify(list));
    }

    function renderEmojiGrid(category) {
        var emojis = emojiCategories[category];
        var html = '<div class="emoji-grid">';
        for (var i = 0; i < emojis.length; i++) {
            html += '<span class="emoji-item" data-emoji="' + emojis[i] + '">' + emojis[i] + '</span>';
        }
        html += '</div>';
        return html;
    }

    function renderRecent() {
        var emojis = getRecentEmojis().slice(0, 8);
        var html = '';
        for (var i = 0; i < emojis.length; i++) {
            html += '<span class="emoji-item" data-emoji="' + emojis[i] + '">' + emojis[i] + '</span>';
        }
        return html;
    }

    var html = `
    <div style="margin-bottom:10px;">
        <label>카테고리</label>
        <select id="emoji-category">
            <option value="😀 감정">😀 감정</option>
<option value="🧍 사람">🧍 사람</option>
<option value="🐶 동물/자연">🐶 동물/자연</option>
<option value="🍕 음식">🍕 음식</option>
<option value="✈️ 장소">✈️ 장소</option>
<option value="⚽ 활동">⚽ 활동</option>
<option value="💡 사물">💡 사물</option>
<option value="💯 기호">💯 기호</option>
<option value="🇰🇷 국기">🇰🇷 국기</option>
        </select>
    </div>
    <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
        <strong style="white-space:nowrap;">🕓 최근 사용</strong>
        <div id="recent-emoji" class="emoji-recent-inline"></div>
    </div>
    <div id="emoji-grid-container">
        <div class="emoji-grid"><span class="emoji-item" data-emoji="😀">😀</span><span class="emoji-item" data-emoji="😃">😃</span><span class="emoji-item" data-emoji="😄">😄</span><span class="emoji-item" data-emoji="😁">😁</span><span class="emoji-item" data-emoji="😆">😆</span><span class="emoji-item" data-emoji="😅">😅</span><span class="emoji-item" data-emoji="🤣">🤣</span><span class="emoji-item" data-emoji="😂">😂</span><span class="emoji-item" data-emoji="🙂">🙂</span><span class="emoji-item" data-emoji="🙃">🙃</span><span class="emoji-item" data-emoji="😉">😉</span><span class="emoji-item" data-emoji="😊">😊</span><span class="emoji-item" data-emoji="😇">😇</span><span class="emoji-item" data-emoji="🥰">🥰</span><span class="emoji-item" data-emoji="😍">😍</span><span class="emoji-item" data-emoji="🤩">🤩</span><span class="emoji-item" data-emoji="😘">😘</span><span class="emoji-item" data-emoji="😗">😗</span><span class="emoji-item" data-emoji="😚">😚</span><span class="emoji-item" data-emoji="😙">😙</span><span class="emoji-item" data-emoji="😋">😋</span><span class="emoji-item" data-emoji="😛">😛</span><span class="emoji-item" data-emoji="😜">😜</span><span class="emoji-item" data-emoji="🤪">🤪</span><span class="emoji-item" data-emoji="😝">😝</span><span class="emoji-item" data-emoji="🤑">🤑</span><span class="emoji-item" data-emoji="🤗">🤗</span><span class="emoji-item" data-emoji="🤭">🤭</span><span class="emoji-item" data-emoji="🤫">🤫</span><span class="emoji-item" data-emoji="🤔">🤔</span><span class="emoji-item" data-emoji="🤐">🤐</span><span class="emoji-item" data-emoji="🤨">🤨</span><span class="emoji-item" data-emoji="😐">😐</span><span class="emoji-item" data-emoji="😑">😑</span><span class="emoji-item" data-emoji="😶">😶</span><span class="emoji-item" data-emoji="😏">😏</span><span class="emoji-item" data-emoji="😒">😒</span><span class="emoji-item" data-emoji="🙄">🙄</span><span class="emoji-item" data-emoji="😬">😬</span><span class="emoji-item" data-emoji="😌">😌</span><span class="emoji-item" data-emoji="😔">😔</span><span class="emoji-item" data-emoji="😪">😪</span><span class="emoji-item" data-emoji="🤤">🤤</span><span class="emoji-item" data-emoji="😴">😴</span><span class="emoji-item" data-emoji="😷">😷</span><span class="emoji-item" data-emoji="🤒">🤒</span><span class="emoji-item" data-emoji="🤕">🤕</span><span class="emoji-item" data-emoji="🤢">🤢</span><span class="emoji-item" data-emoji="🤮">🤮</span><span class="emoji-item" data-emoji="🤧">🤧</span><span class="emoji-item" data-emoji="🥵">🥵</span><span class="emoji-item" data-emoji="🥶">🥶</span><span class="emoji-item" data-emoji="🥴">🥴</span><span class="emoji-item" data-emoji="😵">😵</span><span class="emoji-item" data-emoji="🤯">🤯</span><span class="emoji-item" data-emoji="🤠">🤠</span><span class="emoji-item" data-emoji="🥳">🥳</span><span class="emoji-item" data-emoji="😎">😎</span><span class="emoji-item" data-emoji="🤓">🤓</span><span class="emoji-item" data-emoji="🧐">🧐</span><span class="emoji-item" data-emoji="😕">😕</span><span class="emoji-item" data-emoji="😟">😟</span><span class="emoji-item" data-emoji="🙁">🙁</span><span class="emoji-item" data-emoji="☹️">☹️</span><span class="emoji-item" data-emoji="😮">😮</span><span class="emoji-item" data-emoji="😯">😯</span><span class="emoji-item" data-emoji="😲">😲</span><span class="emoji-item" data-emoji="😳">😳</span><span class="emoji-item" data-emoji="🥺">🥺</span><span class="emoji-item" data-emoji="😦">😦</span><span class="emoji-item" data-emoji="😧">😧</span><span class="emoji-item" data-emoji="😨">😨</span><span class="emoji-item" data-emoji="😰">😰</span><span class="emoji-item" data-emoji="😥">😥</span><span class="emoji-item" data-emoji="😢">😢</span><span class="emoji-item" data-emoji="😭">😭</span><span class="emoji-item" data-emoji="😱">😱</span><span class="emoji-item" data-emoji="😖">😖</span><span class="emoji-item" data-emoji="😣">😣</span><span class="emoji-item" data-emoji="😞">😞</span><span class="emoji-item" data-emoji="😓">😓</span><span class="emoji-item" data-emoji="😩">😩</span><span class="emoji-item" data-emoji="😫">😫</span><span class="emoji-item" data-emoji="🥱">🥱</span><span class="emoji-item" data-emoji="😤">😤</span><span class="emoji-item" data-emoji="😡">😡</span><span class="emoji-item" data-emoji="😠">😠</span><span class="emoji-item" data-emoji="🤬">🤬</span><span class="emoji-item" data-emoji="😈">😈</span><span class="emoji-item" data-emoji="👿">👿</span><span class="emoji-item" data-emoji="💀">💀</span><span class="emoji-item" data-emoji="☠️">☠️</span><span class="emoji-item" data-emoji="👻">👻</span><span class="emoji-item" data-emoji="👽">👽</span><span class="emoji-item" data-emoji="👾">👾</span><span class="emoji-item" data-emoji="🤖">🤖</span></div>
    </div>
`;

    return {
        title: '이모지 선택',
        minWidth: 420,
        minHeight: 480,
        contents: [{
            id: 'emoji-tab',
            label: '이모지',
            elements: [{
                type: 'html',
                html: html
            }]
        }],
        onShow: function() {
            setTimeout(function() {
                document.getElementById('emoji-category').addEventListener('change', function() {
                    document.getElementById('emoji-grid-container').innerHTML = renderEmojiGrid(this.value);
                    bindClickEvents();
                });

                function bindClickEvents() {
                    var items = document.querySelectorAll('.emoji-item');
                    items.forEach(function(item) {
                        item.addEventListener('click', function() {
                            var emoji = this.getAttribute('data-emoji');
                            editor.insertHtml(emoji);
                            saveRecentEmoji(emoji);
                            var dlg = CKEDITOR.dialog.getCurrent();
                            if (dlg) dlg.hide();
                        });
                    });
                }

                // Refresh recent emojis
                document.querySelector('#recent-emoji').innerHTML = renderRecent();
                bindClickEvents();
            }, 50);
        }
    };
});
